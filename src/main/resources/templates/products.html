<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title th:text="${pageTitle}">Sản Phẩm</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Breadcrumb -->
        <section class="bg-light py-3">
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a th:href="@{/}">Trang Chủ</a></li>
                        <li class="breadcrumb-item active">Sản Phẩm</li>
                    </ol>
                </nav>
            </div>
        </section>

        <!-- Main Content -->
        <section class="py-5">
            <div class="container">
                <div class="row">
                    <!-- Sidebar Filter -->
                    <div class="col-md-3 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="bi bi-funnel"></i> Bộ Lọc</h6>
                            </div>
                            <div class="card-body">
                                <!-- Categories -->
                                <h6 class="fw-bold mb-3">Danh Mục</h6>
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <a th:href="@{/products}" 
                                           class="text-decoration-none"
                                           th:classappend="${selectedCategory == null} ? 'fw-bold text-primary' : ''">
                                            Tất Cả Sản Phẩm
                                        </a>
                                    </li>
                                    <li class="mb-2" th:each="category : ${categories}">
                                        <a th:href="@{/products/category/{slug}(slug=${category.slug})}" 
                                           class="text-decoration-none"
                                           th:classappend="${selectedCategory != null && selectedCategory.id == category.id} ? 'fw-bold text-primary' : ''">
                                            <span th:text="${category.name}">Category</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div class="col-md-9">
                        <!-- Header -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="mb-0">
                                <span th:if="${selectedCategory != null}" th:text="${selectedCategory.name}">Tất Cả Sản Phẩm</span>
                                <span th:if="${selectedCategory == null && searchKeyword == null}">Tất Cả Sản Phẩm</span>
                                <span th:if="${searchKeyword != null}">Kết quả tìm kiếm: "<span th:text="${searchKeyword}"></span>"</span>
                            </h2>
                            <span class="text-muted">
                                <span th:text="${products.totalElements}">0</span> sản phẩm
                            </span>
                        </div>

                        <!-- Products Grid -->
                        <div class="row">
                            <div class="col-md-4 mb-4" th:each="product : ${products.content}">
                                <div class="card h-100 shadow-sm product-card">
                                    <!-- Badges -->
                                    <div class="position-relative">
                                        <span class="badge bg-danger position-absolute m-2" th:if="${product.isBestseller}">
                                            <i class="bi bi-star-fill"></i> Bestseller
                                        </span>
                                        <span class="badge bg-success position-absolute end-0 m-2" th:if="${product.isVegan}">
                                            <i class="bi bi-leaf"></i> Vegan
                                        </span>
                                        <img th:src="${product.imageUrl}" 
                                             th:alt="${product.name}" 
                                             class="card-img-top"
                                             style="height: 200px; object-fit: cover;">
                                    </div>
                                    
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title" th:text="${product.name}">Product Name</h5>
                                        <p class="card-text text-muted flex-grow-1" th:text="${product.description}">Description</p>
                                        
                                        <!-- Rating -->
                                        <div class="mb-2">
                                            <span th:each="i : ${#numbers.sequence(1, 5)}"
                                                  th:classappend="${i <= product.rating} ? 'text-warning' : 'text-muted'">
                                                <i class="bi bi-star-fill"></i>
                                            </span>
                                            <small class="text-muted" th:text="'(' + ${product.reviewCount} + ' đánh giá)'"></small>
                                        </div>
                                        
                                        <!-- Price & Actions -->
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="text-primary fw-bold fs-5" 
                                                  th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + '₫'">
                                                45,000₫
                                            </span>
                                            <div>
                                                <button class="btn btn-sm btn-outline-primary me-1" 
                                                        th:onclick="'addToCart(' + ${product.id} + ')'"
                                                        title="Thêm vào giỏ">
                                                    <i class="bi bi-cart-plus"></i>
                                                </button>
                                                <a th:href="@{/products/{slug}(slug=${product.slug})}" 
                                                   class="btn btn-sm btn-primary">
                                                    Xem
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div class="text-center py-5" th:if="${products.empty}">
                            <i class="bi bi-inbox fs-1 text-muted"></i>
                            <p class="text-muted mt-3">Không tìm thấy sản phẩm nào</p>
                            <a th:href="@{/products}" class="btn btn-primary">Xem Tất Cả Sản Phẩm</a>
                        </div>

                        <!-- Pagination -->
                        <nav th:if="${products.totalPages > 1}" class="mt-4">
                            <ul class="pagination justify-content-center">
                                <!-- Previous -->
                                <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                                    <a class="page-link" 
                                       th:href="@{${#httpServletRequest.requestURI}(page=${currentPage - 1})}"
                                       aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                
                                <!-- Page Numbers -->
                                <li class="page-item" 
                                    th:each="i : ${#numbers.sequence(0, products.totalPages - 1)}"
                                    th:classappend="${i == currentPage} ? 'active'">
                                    <a class="page-link" 
                                       th:href="@{${#httpServletRequest.requestURI}(page=${i})}"
                                       th:text="${i + 1}">1</a>
                                </li>
                                
                                <!-- Next -->
                                <li class="page-item" th:classappend="${currentPage == products.totalPages - 1} ? 'disabled'">
                                    <a class="page-link" 
                                       th:href="@{${#httpServletRequest.requestURI}(page=${currentPage + 1})}"
                                       aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>
